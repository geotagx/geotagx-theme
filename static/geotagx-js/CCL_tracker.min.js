/*! CCL-Tracker v0.1 | Ioannis Charalampidis, Citizen Cyberlab EU Project | GNU GPL v2.0 License */
(window.define==undefined?function(a){window.analytics=a()}:window.define)(function(){var b=function(){this.stack=[];this.enabled=false;this.expired=false;this.initializedAt=Date.now();this.timeoutTime=this.initializedAt+10000;this.listener=null;this.timers={};this.timerAccummulators={};this.globals={};this.probeTimer=setInterval(this.probeListener.bind(this),100)};b.prototype.disable=function(){this.expired=true;this.enabled=false};b.prototype.probeListener=function(){if(this.enabled||this.expired){return}if(Date.now()>this.timeoutTime){clearInterval(this.probeTimer);this.expired=true;this.stack=[];return}if(!window.analyticsListener){return}clearInterval(this.probeTimer);this.listener=window.analyticsListener;this.enabled=true;for(var c=0;c<this.stack.length;c++){this.send(this.stack[c][0],this.stack[c][1])}this.stack=[]};b.prototype.fireEvent=function(c,f,e){this.probeListener();if(!this.enabled||this.expired){return}if(!f){f={}}for(k in this.globals){f[k]=this.globals[k]}console.log("Analytics: ",c,f);if(this.expired){return}if(this.enabled){this.send(c,f)}else{if(e){for(var d=0;d<this.stack.length;d++){if(this.stack[d][0]==c){this.stack[d]=[c,f];return}}}this.stack.push([c,f])}};b.prototype.send=function(c,d){if(d.ts==undefined){d.ts=Date.now()}if(this.listener){try{if(this.listener===true){$(window).trigger("analytics."+c,[d])}else{this.listener(c,d)}}catch(f){}}};b.prototype.setGlobal=function(c,d){this.globals[c]=d};b.prototype.freeze=function(){for(name in this.timers){this.timerAccummulators[name]+=(Date.now()-this.timers[name])}};b.prototype.thaw=function(){for(name in this.timers){this.timers[name]=Date.now()}};b.prototype.startTimer=function(c){if(this.timers[c]!==undefined){return}this.timers[c]=Date.now();this.timerAccummulators[c]=0};b.prototype.restartTimer=function(c){var d=this.stopTimer(c);this.timers[c]=Date.now();this.timerAccummulators[c]=0;return d};b.prototype.getTimer=function(c){if(!this.timers[c]){return 0}return(Date.now()-this.timers[c])+this.timerAccummulators[c]};b.prototype.stopTimer=function(c){if(!this.timers[c]){return 0}var d=(Date.now()-this.timers[c])+this.timerAccummulators[c];delete this.timers[c];delete this.timerAccummulators[c];return d};var a=new b();window.addEventListener("blur",function(c){a.freeze()});window.addEventListener("focus",function(c){a.thaw()});return a});